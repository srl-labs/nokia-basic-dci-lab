name: dci

topology:
  kinds:
    nokia_sros:
      image: registry.srlinux.dev/pub/vr-sros:23.10.R1
      type: sr-1s
      license: /opt/nokia/sros/r23_license.key
    nokia_srlinux:
      image: ghcr.io/nokia/srlinux:23.10.1
      type: ixrd3
  nodes:
    ############## CORE ##############
    p1:
      kind: nokia_sros
      startup-config: configs/p1.partial.cfg

    ############## DC 1 ##############
    dcgw1_dc1:
      kind: nokia_sros
      startup-config: configs/dcgw1_dc1.partial.cfg

    dcgw2_dc1:
      kind: nokia_sros
      startup-config: configs/dcgw2_dc1.partial.cfg

    spine1_dc1:
      kind: nokia_srlinux
      startup-config: configs/spine1_dc1.cfg

    spine2_dc1:
      kind: nokia_srlinux
      startup-config: configs/spine2_dc1.cfg

    leaf1_dc1:
      kind: nokia_srlinux
      startup-config: configs/leaf1_dc1.cfg

    leaf2_dc1:
      kind: nokia_srlinux
      startup-config: configs/leaf2_dc1.cfg

    leaf3_dc1:
      kind: nokia_srlinux
      startup-config: configs/leaf3_dc1.cfg

    leaf4_dc1:
      kind: nokia_srlinux
      startup-config: configs/leaf4_dc1.cfg

    client1_dc1:
      kind: linux
      image: ghcr.io/hellt/network-multitool
      binds:
        - configs/client.sh:/client.sh
      # exec:
      #   - ash -c "/client.sh dc1 1"

    ############## DC 2 ##############
    dcgw1_dc2:
      kind: nokia_sros
      startup-config: configs/dcgw1_dc2.partial.cfg
      stages:
        create:
          wait-for:
            - node: dcgw1_dc1
              stage: healthy
            - node: dcgw2_dc1
              stage: healthy

    dcgw2_dc2:
      kind: nokia_sros
      startup-config: configs/dcgw2_dc2.partial.cfg
      stages:
        create:
          wait-for:
            - node: dcgw1_dc1
              stage: healthy
            - node: dcgw2_dc1
              stage: healthy

    spine1_dc2:
      kind: nokia_srlinux
      startup-config: configs/spine1_dc2.cfg

    spine2_dc2:
      kind: nokia_srlinux
      startup-config: configs/spine2_dc2.cfg

    leaf1_dc2:
      kind: nokia_srlinux
      startup-config: configs/leaf1_dc2.cfg

    leaf2_dc2:
      kind: nokia_srlinux
      startup-config: configs/leaf2_dc2.cfg

    leaf3_dc2:
      kind: nokia_srlinux
      startup-config: configs/leaf3_dc2.cfg

    leaf4_dc2:
      kind: nokia_srlinux
      startup-config: configs/leaf4_dc2.cfg

    client1_dc2:
      kind: linux
      image: ghcr.io/hellt/network-multitool
      binds:
        - configs/client.sh:/client.sh
      # exec:
      #   - ash -c "/client.sh dc2 1"

  links:
    ############## DC 1 ##############
    #######################################################
    ################## DCGW - CORE#########################
    #######################################################
    - endpoints: ["dcgw1_dc1:eth1", "p1:eth5"]
    - endpoints: ["dcgw2_dc1:eth1", "p1:eth6"]
    #######################################################
    ################## DCGW - Spine #######################
    #######################################################
    - endpoints: ["spine1_dc1:e1-31", "dcgw1_dc1:eth3"]
    - endpoints: ["spine1_dc1:e1-32", "dcgw2_dc1:eth3"]
    - endpoints: ["spine2_dc1:e1-31", "dcgw1_dc1:eth2"]
    - endpoints: ["spine2_dc1:e1-32", "dcgw2_dc1:eth2"]
    #######################################################
    ################## Spine 1 - Leafs ####################
    #######################################################
    - endpoints: ["spine1_dc1:e1-3", "leaf1_dc1:e1-31"]
    - endpoints: ["spine1_dc1:e1-4", "leaf2_dc1:e1-31"]
    - endpoints: ["spine1_dc1:e1-5", "leaf3_dc1:e1-31"]
    - endpoints: ["spine1_dc1:e1-6", "leaf4_dc1:e1-31"]
    #######################################################
    ################## Spine 2 - Leafs ####################
    #######################################################
    - endpoints: ["spine2_dc1:e1-3", "leaf1_dc1:e1-32"]
    - endpoints: ["spine2_dc1:e1-4", "leaf2_dc1:e1-32"]
    - endpoints: ["spine2_dc1:e1-5", "leaf3_dc1:e1-32"]
    - endpoints: ["spine2_dc1:e1-6", "leaf4_dc1:e1-32"]
    #######################################################
    ################## Clients - Leafs ####################
    #######################################################
    - endpoints: ["client1_dc1:eth1", "leaf1_dc1:e1-1"]

    ############## DC 2 ##############
    #######################################################
    ################## DCGW - CORE#########################
    #######################################################
    - endpoints: ["dcgw1_dc2:eth1", "p1:eth1"]
    - endpoints: ["dcgw2_dc2:eth1", "p1:eth2"]
    #####################################################
    ################## DCGW - Spine #####################
    #####################################################
    - endpoints: ["spine1_dc2:e1-31", "dcgw1_dc2:eth3"]
    - endpoints: ["spine1_dc2:e1-32", "dcgw2_dc2:eth3"]
    - endpoints: ["spine2_dc2:e1-31", "dcgw1_dc2:eth2"]
    - endpoints: ["spine2_dc2:e1-32", "dcgw2_dc2:eth2"]
    #####################################################
    ################## Spine 1 - Leafs ##################
    #####################################################
    - endpoints: ["spine1_dc2:e1-3", "leaf1_dc2:e1-31"]
    - endpoints: ["spine1_dc2:e1-4", "leaf2_dc2:e1-31"]
    - endpoints: ["spine1_dc2:e1-5", "leaf3_dc2:e1-31"]
    - endpoints: ["spine1_dc2:e1-6", "leaf4_dc2:e1-31"]
    #######################################################
    ################## Spine 2 - Leafs ####################
    #######################################################
    - endpoints: ["spine2_dc2:e1-3", "leaf1_dc2:e1-32"]
    - endpoints: ["spine2_dc2:e1-4", "leaf2_dc2:e1-32"]
    - endpoints: ["spine2_dc2:e1-5", "leaf3_dc2:e1-32"]
    - endpoints: ["spine2_dc2:e1-6", "leaf4_dc2:e1-32"]
    #######################################################
    ################## Clients - Leafs ####################
    #######################################################
    - endpoints: ["client1_dc2:eth1", "leaf1_dc2:e1-1"]
